#!/bin/bash

CmdName=$(basename "$0")
Syntax="${CmdName} [-c config][-n]([-p ProjectId]|[-s SubjectId])[-v]

function sys {
	[ -n "${opt_n}${opt_v}" ] && echo "$@" 1>&2
	[ -n "$opt_n" ] || "$@"
}


while getopts c:ns:v arg
do
	case "$arg" in
		c|n|s|v)
			eval "opt_${arg}='${OPTARG:=1}'"
			;;
	esac
done

shift $(("$OPTIND" - 1))

if [ -n "$opt_c" ]
then
	ConfigJsonFile="$opt_c"
else
	ConfigJsonFile="${FLYWHEEL}/config.json"
fi

InputDir=/flywheel/v0/input
TmpDir=/tmp/aloha

[ -d "$TmpDir" ] || mkdir -p "$TmpDir"

Are we doing the whole project, or just a subject?
Are we just generating the AlohaInputs json, or generating a report, or just running aloha

SubjectId=$(fwget -1 "$AcquisitionId" | jq -r '.parents.subject' | fwget -1 | jq -r '._id')
	if [ -z "$SubjectId" ]
        then
                echo "${CmdName} : can not find SubjectId from '$AcquisitionId'" 1>&2
                exit 2
        fi

	echo "SubjectId = '$SubjectId'"

	 TmpSubjectDir="${TmpDir}/${SubjectId}"
	 [ -d "$TmpSubjectDir" ] || mkdir -p "$TmpSubjectDir"
         TmpFwSubjectJsonFile="$TmpSubjectDir"/FwSubject.json

